System.register(["jimu-core","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/setting-components","jimu-ui"],(function(e,t){var a={},c={},n={},l={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.Immutable=e.Immutable,a.React=e.React,a.appActions=e.appActions,a.getAppStore=e.getAppStore},function(e){c.DataSourceSelector=e.DataSourceSelector},function(e){n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection},function(e){l.AdvancedSelect=e.AdvancedSelect,l.Switch=e.Switch,l.TextInput=e.TextInput}],execute:function(){e((()=>{var e={891:e=>{"use strict";e.exports=a},726:e=>{"use strict";e.exports=l},338:e=>{"use strict";e.exports=c},756:e=>{"use strict";e.exports=n}},t={};function r(a){var c=t[a];if(void 0!==c)return c.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var o={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(o),r.d(o,{default:()=>s});var e=r(891),t=r(338),a=r(756),c=r(726);function n({parentSource:t,parentDisplay:n,source:l,geometryType:r,fieldSchema:o,selectedSchema:s,dsProp:i,dsPropChange:u,onFieldChange:d}){const[p,g]=e.React.useState(!1),S=e=>e.map((e=>{const t={};return t.label=e.alias,t.value=e.name,t})),m=e=>Object.prototype.hasOwnProperty.call(i,e)&&i[e]||null,f=S(o),R=S(s),w=f.filter((e=>e.value===m("foreignKey"))),y=f.filter((e=>e.value===m("header"))),h=f.filter((e=>e.value===m("subHeader"))),[b,D]=e.React.useState(!1),[E,v]=e.React.useState(!1),[P,C]=e.React.useState(!1),x=e=>!!Object.prototype.hasOwnProperty.call(i,e)&&!!i[e],O=e=>{const t=e?e[0].value:null;u(l,"foreignKey",t)};return t()!==l||t()===l&&n()?e.React.createElement(e.React.Fragment,null,e.React.createElement(a.SettingSection,{title:"Join field"},e.React.createElement(a.SettingRow,null,e.React.createElement(c.AdvancedSelect,{fluid:!0,strategy:"fixed",selectedValues:w,staticValues:f,onChange:O,isOpen:b,toggle:e=>D(e)}))),e.React.createElement(a.SettingSection,{title:"Select Fields"},e.React.createElement(a.SettingRow,null,e.React.createElement(c.AdvancedSelect,{fluid:!0,strategy:"fixed",isMultiple:!0,staticValues:f,selectedValues:R,onChange:e=>{const t=e.map((e=>e.value));d(t,l)},isOpen:p,toggle:e=>g(e)}))),e.React.createElement(a.SettingSection,{title:"List Labels"},e.React.createElement(a.SettingRow,{label:"Header",flow:"wrap"},e.React.createElement(c.AdvancedSelect,{fluid:!0,strategy:"fixed",staticValues:f,selectedValues:y,onChange:e=>{const t=e?e[0].value:null;u(l,"header",t)},isOpen:E,toggle:e=>v(e)})),e.React.createElement(a.SettingRow,{label:"SubHeader (optional)",flow:"wrap"},e.React.createElement(c.AdvancedSelect,{fluid:!0,strategy:"fixed",staticValues:f,selectedValues:h,onChange:e=>{const t=e?e[0].value:null;u(l,"subHeader",t)},isOpen:P,toggle:e=>C(e)}))),!r&&e.React.createElement(a.SettingSection,null,e.React.createElement(a.SettingRow,null,e.React.createElement("div",{className:"w-100 table-options"},e.React.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},className:"table-options-item"},e.React.createElement("span",{className:"setting-text-level-1",style:{width:"80%"}},"Create New Records"),e.React.createElement(c.Switch,{className:"can-x-switch",id:"newFeatures",checked:x("newFeatures"),onChange:(e,t)=>{u(l,"newFeatures",t)}})))),e.React.createElement(a.SettingRow,null,e.React.createElement("div",{className:"w-100 table-options"},e.React.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},className:"table-options-item"},e.React.createElement("span",{className:"setting-text-level-1",style:{width:"80%"}},"Delete Records"),e.React.createElement(c.Switch,{className:"can-x-switch",id:"deleteFeatures",checked:x("deleteFeatures"),onChange:(e,t)=>{u(l,"deleteFeatures",t)}})))))):e.React.createElement(a.SettingSection,{title:"Join field"},e.React.createElement(a.SettingRow,null,e.React.createElement(c.AdvancedSelect,{fluid:!0,strategy:"fixed",selectedValues:w,staticValues:f,onChange:O,isOpen:b,toggle:e=>D(e)})))}function l(t){const l=t.useDataSource.map((e=>e.dataSourceId)),r=(e,a)=>Object.prototype.hasOwnProperty.call(t.config,"dsProps")&&Object.prototype.hasOwnProperty.call(t.config.dsProps,a)?t.config.dsProps[a][e]:null,[o,s]=e.React.useState((()=>(()=>{const e={};return l.forEach((t=>{e[t]=r("label",t)})),e})())),[i,u]=e.React.useState(l[0]);l.includes(i)||u(l[0]);const[d,p]=e.React.useState(!1),g=(a,c)=>{if("LOADED"!==c.status)return null;const l=a.layer.fields,r=t.useDataSource.find((e=>e.dataSourceId===i)).fields,o=r?l.filter((e=>r.includes(e.name))):[];return e.React.createElement(n,{dsProp:(s=i,Object.prototype.hasOwnProperty.call(t.config,"dsProps")&&Object.prototype.hasOwnProperty.call(t.config.dsProps,s)&&t.config.dsProps[s]||{}),dsPropChange:t.dsPropChange,onFieldChange:t.onFieldChange,source:i,fieldSchema:l,selectedSchema:o,geometryType:a.getGeometryType(),parentSource:S,parentDisplay:m});var s},S=()=>Object.prototype.hasOwnProperty.call(t.config,"parentDataSource")?t.config.parentDataSource:null,m=()=>!!Object.prototype.hasOwnProperty.call(t.config,"displayParent")&&t.config.displayParent,f=(()=>{const t=e.DataSourceManager.getInstance().getDataSources();return Object.keys(t).filter((e=>l.includes(t[e].id))).map((e=>{const a={};return a.label=r("label",t[e].id)||t[e].getLabel(),a.value=t[e].id,a}))})(),R=f.filter((e=>e.value===i));return e.React.createElement(e.React.Fragment,null,e.React.createElement(a.SettingSection,{title:"Select Data Source"},e.React.createElement(a.SettingRow,null,e.React.createElement(c.AdvancedSelect,{fluid:!0,strategy:"fixed",staticValues:f,selectedValues:R,onChange:e=>{u(e[0].value)},isOpen:d,toggle:e=>p(e)})),e.React.createElement(a.SettingRow,{label:"Label",flow:"wrap"},e.React.createElement(c.TextInput,{key:"labelInput",value:o[i]||"",onChange:e=>{const t=Object.assign({},o);t[i]=e.target.value,s(t)},onAcceptValue:e=>{t.dsPropChange(i,"label",e)},type:"text",size:"sm",className:"w-100",placeholder:"Data Source Label","aria-label":"label"})),(!S()||S()===i)&&e.React.createElement(a.SettingRow,null,e.React.createElement("div",{className:"w-100 table-options"},e.React.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},className:"table-options-item"},e.React.createElement("span",{className:"setting-text-level-1",style:{width:"80%"}},"Parent Data Source?"),e.React.createElement(c.Switch,{className:"can-x-switch",id:"parentDataSource",checked:t.config.parentDataSource===i,onChange:(a,c)=>{c?((0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(t.widgetId,"parentDataSource",i)),t.configRootParam(a.target.id,i)):((0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(t.widgetId,"parentDataSource",null)),t.configRootParam(a.target.id,null))}})))),S()===i&&e.React.createElement(a.SettingRow,null,e.React.createElement("div",{className:"w-100 table-options"},e.React.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},className:"table-options-item"},e.React.createElement("span",{className:"setting-text-level-1",style:{width:"80%"}},"Show in Widget?"),e.React.createElement(c.Switch,{className:"can-x-switch",id:"displayParent",checked:m(),onChange:(e,a)=>{t.configRootParam(e.target.id,a)}}))))),(()=>{let a=0;return t.useDataSource.forEach(((e,t)=>{e.dataSourceId===i&&(a=t)})),e.React.createElement(e.DataSourceComponent,{useDataSource:t.useDataSource[a],query:{where:"1=1"},widgetId:t.widgetId},g)})())}function s(c){const n=(e,t)=>{const a=c.config;a[e]=t,c.onSettingChange({id:c.id,useDataSources:[...c.useDataSources],config:a})};return e.React.createElement("div",{className:"use-feature-layer-setting p-2"},e.React.createElement(a.SettingSection,{title:"Data"},e.React.createElement(a.SettingRow,null,e.React.createElement(t.DataSourceSelector,{types:(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer]),useDataSources:c.useDataSources,useDataSourcesEnabled:!0,mustUseDataSource:!0,onChange:e=>{const t=c.config;t.parentDataSource&&(e.map((e=>e.dataSourceId)).includes(t.parentDataSource)||n("parentDataSource",null)),c.onSettingChange({id:c.id,useDataSources:e})},widgetId:c.id,isMultiple:!0}))),c.useDataSources&&c.useDataSources.length>0&&e.React.createElement(l,{useDataSource:c.useDataSources,onFieldChange:(e,t)=>{c.onSettingChange({id:c.id,useDataSources:[...c.useDataSources].map((a=>a.dataSourceId===t?Object.assign(Object.assign({},a),{fields:e}):a))})},selectedFields:(()=>{let t=(0,e.Immutable)({});return c.useDataSources.forEach((e=>{t=t.set(e.dataSourceId,e.fields?e.fields:[])})),t})()||(0,e.Immutable)([]),widgetId:c.id,config:c.config,dsPropChange:(e,t,a)=>{const n=c.config,l=n.dsProps||{},r=l[e]||{};r[t]=a,l[e]=r,n.dsProps=l,c.onSettingChange({id:c.id,useDataSources:[...c.useDataSources],config:n})},configRootParam:n}))}})(),o})())}}}));